# การแก้ไขปัญหา Filter State Management

## ปัญหาที่พบ
ในหน้า Customer Management (`customers.php?tab=all`) เมื่อผู้ใช้ใช้ตัวกรองต่างๆ เช่น เลือกสถานะ เลือกเกรด เลือกจังหวัด แล้วไปหน้าอื่น เมื่อกลับมาหน้าเดิม ตัวกรองยังคงแสดงอยู่แต่ข้อมูลแสดงทั้งหมด ไม่ได้ถูกกรองตามที่เลือกไว้ ทำให้ต้องมานั่งกรองใหม่ทุกครั้ง

## สาเหตุของปัญหา
ปัญหาอยู่ที่การจัดการ state ของตัวกรองในฝั่ง client-side:
1. ตัวกรองถูกบันทึกลง `sessionStorage` แต่ไม่ถูก restore และ apply กลับมาเมื่อโหลดหน้าใหม่
2. เมื่อเปลี่ยนแท็บ ตัวกรองถูกล้างออกแทนที่จะถูกเก็บไว้
3. ไม่มี event listeners สำหรับตัวกรองในแท็บ "ลูกค้าทั้งหมด"

## การแก้ไขที่ถูกต้อง
**หมายเหตุ: การแก้ไขก่อนหน้านี้ผิด - ล้างตัวกรองแทนที่จะเก็บไว้**

### การแก้ไขที่ถูกต้อง:
1. **ไม่ล้างตัวกรองเมื่อโหลดหน้าใหม่** - ใช้ `restoreFiltersFromStorage()` แทน `clearAllFilters()`
2. **ไม่ล้างตัวกรองเมื่อเปลี่ยนแท็บ** - restore และ apply ตัวกรองกลับมา
3. **เพิ่ม event listeners สำหรับตัวกรองในแท็บ "ลูกค้าทั้งหมด"**
4. **ลบ URL change event listeners ที่ล้างตัวกรอง**

### ไฟล์ที่แก้ไข:
- `assets/js/customers.js`

### การเปลี่ยนแปลงหลัก:
1. **DOMContentLoaded event:**
   ```javascript
   // เดิม: clearAllFilters();
   // ใหม่: restoreFiltersFromStorage();
   ```

2. **Tab change event:**
   ```javascript
   // เดิม: clearAllFilters();
   // ใหม่: restore filters และ apply filters
   ```

3. **เพิ่ม event listeners สำหรับ "All Customers" tab filters:**
   ```javascript
   const allTabFilterIds = ['nameFilter_all', 'phoneFilter_all', 'temperatureFilter_all', 'gradeFilter_all', 'provinceFilter_all', 'customerTypeFilter_all'];
   ```

4. **ลบ URL change event listeners ที่ล้างตัวกรอง**

## ผลลัพธ์ที่คาดหวัง
- ตัวกรองจะถูกเก็บไว้เมื่อเปลี่ยนหน้าและกลับมา
- ข้อมูลจะถูกแสดงตามตัวกรองที่เลือกไว้โดยอัตโนมัติ
- ไม่ต้องมานั่งกรองใหม่ทุกครั้งที่เปิดหน้า

## วิธีการทดสอบ
1. เปิดหน้า Customer Management
2. เลือกตัวกรองต่างๆ (สถานะ, เกรด, จังหวัด, ฯลฯ)
3. ไปหน้าอื่น
4. กลับมาหน้า Customer Management
5. ตรวจสอบว่า:
   - ตัวกรองยังคงแสดงค่าที่เลือกไว้
   - ข้อมูลถูกแสดงตามตัวกรองที่เลือกไว้
   - ไม่ต้องกดปุ่มกรองใหม่

## หมายเหตุสำคัญ
การแก้ไขนี้ทำให้ตัวกรองทำงานตามที่ผู้ใช้ต้องการจริงๆ คือ **เก็บตัวกรองไว้และแสดงข้อมูลตามตัวกรอง** ไม่ใช่การล้างตัวกรองออก
