# การปรับปรุงระบบ Import ให้รองรับ Template แบบง่าย

## วัตถุประสงค์
เพื่อให้ระบบสามารถนำเข้าข้อมูลยอดขายได้แม้ว่าจะไม่มีคอลัมน์ "ราคาต่อชิ้น" ในไฟล์ CSV และเหลือแค่ "ยอดรวม" เท่านั้น

## การเปลี่ยนแปลงที่ทำ

### 1. ปรับปรุง ImportExportService.php
- **ฟังก์ชัน `updateCustomerPurchaseHistory()`**: ปรับปรุงการคำนวณ `total_amount` และ `net_amount`
  - ถ้ามีราคาต่อชิ้น: คำนวณจาก `จำนวน × ราคาต่อชิ้น`
  - ถ้าไม่มีราคาต่อชิ้น แต่มียอดรวม: ใช้ยอดรวมจาก CSV และคำนวณราคาต่อชิ้นย้อนกลับ
  - ถ้าไม่มีทั้งคู่: ใช้ค่าเริ่มต้น 0

### 2. สร้าง Template ใหม่
- **ไฟล์ `templates/sales_import_template_simple.csv`**: Template แบบง่ายที่ไม่มีคอลัมน์ "ราคาต่อชิ้น"
- **คอลัมน์ที่มี**: ชื่อ, นามสกุล, เบอร์โทรศัพท์, อีเมล, ที่อยู่, เขต, จังหวัด, รหัสไปรษณีย์, รหัสสินค้า, ชื่อสินค้า, จำนวน, ยอดรวม, วันที่สั่งซื้อ, ช่องทางการขาย, ผู้ติดตาม, ผู้ขาย, วิธีการชำระเงิน, สถานะการชำระเงิน, หมายเหตุ

### 3. ปรับปรุง ImportExportController.php
- **ฟังก์ชัน `downloadTemplate()`**: เพิ่ม template แบบง่าย `sales_simple`
- **Headers และ Sample Data**: ปรับให้ไม่มีคอลัมน์ "ราคาต่อชิ้น"

### 4. ปรับปรุง UI
- **ไฟล์ `app/views/import-export/index.php`**: 
  - เพิ่มปุ่มดาวน์โหลด Template แบบง่าย
  - ปรับปรุงคำแนะนำการนำเข้าข้อมูล
  - อธิบายความแตกต่างระหว่าง Template แบบเต็มและแบบง่าย

## วิธีการทำงาน

### Template แบบเต็ม (เดิม)
```
ชื่อ,นามสกุล,เบอร์โทรศัพท์,...,จำนวน,ราคาต่อชิ้น,ยอดรวม,...
สมชาย,ใจดี,0812345678,...,2,1500,3000,...
```

### Template แบบง่าย (ใหม่)
```
ชื่อ,นามสกุล,เบอร์โทรศัพท์,...,จำนวน,ยอดรวม,...
สมชาย,ใจดี,0812345678,...,2,3000,...
```

### การคำนวณอัตโนมัติ
เมื่อใช้ Template แบบง่าย:
1. ระบบจะใช้ "ยอดรวม" จาก CSV เป็น `total_amount` และ `net_amount`
2. ระบบจะคำนวณ "ราคาต่อชิ้น" ย้อนกลับ = `ยอดรวม ÷ จำนวน`
3. ราคาต่อชิ้นที่คำนวณได้จะถูกบันทึกในตาราง `order_items` เพื่อการแสดงผล

## ข้อดี
1. **ความง่าย**: ผู้ใช้ไม่ต้องกรอกราคาต่อชิ้น แค่กรอกยอดรวมเท่านั้น
2. **ความยืดหยุ่น**: รองรับทั้ง Template แบบเต็มและแบบง่าย
3. **ความถูกต้อง**: ระบบคำนวณอัตโนมัติเพื่อให้ข้อมูลครบถ้วน
4. **ความสะดวก**: ลดความซับซ้อนในการเตรียมข้อมูล

## การใช้งาน
1. ไปที่หน้า Import/Export
2. ในส่วน "นำเข้ายอดขาย" จะมีปุ่มดาวน์โหลด 2 แบบ:
   - **Template ยอดขาย (แบบเต็ม)**: มีคอลัมน์ราคาต่อชิ้น
   - **Template ยอดขาย (แบบง่าย)**: มีแค่ยอดรวม
3. เลือกดาวน์โหลด Template ที่ต้องการ
4. กรอกข้อมูลตาม Template
5. อัพโหลดไฟล์ CSV

## หมายเหตุ
- Template แบบง่ายเหมาะสำหรับกรณีที่รู้ยอดรวมแล้วแต่ไม่ต้องการกรอกราคาต่อชิ้น
- ระบบจะคำนวณราคาต่อชิ้นให้อัตโนมัติเพื่อความครบถ้วนของข้อมูล
- สามารถใช้ Template แบบเต็มได้ตามปกติหากต้องการควบคุมราคาต่อชิ้นเอง
